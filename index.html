<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Manuale JSON – SOLO Payload (Suggestion schema)</title>
<style>
  :root{--bg:#0b0d10;--panel:#11151a;--muted:#8a98a9;--txt:#e6eef7;--accent:#41a4ff;--accent-2:#00c7a5;--warn:#ffcc00;--bad:#ff6b6b;--good:#1ecb7b;--card:#0f1318;--shadow:0 10px 30px rgba(0,0,0,.35);--border:1px solid rgba(255,255,255,.08)}
  .light{--bg:#f6f8fb;--panel:#fff;--muted:#5a6674;--txt:#0d1117;--accent:#0b74ff;--accent-2:#00a38c;--warn:#b58900;--bad:#d7263d;--good:#0f915a;--card:#fff;--shadow:0 8px 24px rgba(0,0,0,.08);--border:1px solid rgba(0,0,0,.08)}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  .layout{display:grid;grid-template-columns:300px 1fr;gap:16px;max-width:1400px;margin:0 auto;padding:20px}
  header{grid-column:1/3;background:linear-gradient(120deg,var(--panel),rgba(65,164,255,.08));border:var(--border);border-radius:18px;padding:24px;box-shadow:var(--shadow)}
  h1{margin:0 0 8px;font-size:28px;letter-spacing:.2px}
  .lead{color:var(--muted);margin:0}
  .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
  .input, select, button{background:var(--panel);color:var(--txt);border:var(--border);border-radius:12px;padding:10px 12px;font:inherit}
  button{cursor:pointer}
  button.primary{background:var(--accent);color:#fff;border:none}
  button.ghost{background:transparent;border:var(--border)}
  .badge{display:inline-flex;gap:6px;align-items:center;border-radius:999px;border:var(--border);padding:2px 10px;color:var(--muted);font-size:12px}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .grid{display:grid;gap:16px}
  .two{grid-template-columns:1fr 1fr}
  .card{background:var(--card);border:var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .muted{color:var(--muted)}
  pre{background:var(--panel);border:var(--border);border-radius:14px;padding:14px;overflow:auto}
  .nav{position:sticky;top:20px;align-self:start;background:var(--panel);border:var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
  .nav a{display:block;padding:8px 10px;border-radius:10px;color:var(--txt)}
  .nav a:hover{background:rgba(255,255,255,.05)}
  .section{scroll-margin-top:90px}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:var(--border);padding:10px 8px;vertical-align:top}
  th{text-align:left;color:var(--muted);font-weight:600}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:var(--border);font-size:12px}
  .pill.req{background:rgba(255,107,107,.1);color:var(--bad)}
  details{background:var(--card);border:var(--border);border-radius:14px;padding:12px}
  .tabbar{display:flex;gap:8px;margin-bottom:12px}
  .tabbar button.active{background:var(--accent);color:#fff;border:none}
  .callout{border-left:4px solid var(--accent);padding:10px 12px;background:linear-gradient(90deg, rgba(65,164,255,.08), transparent);border-radius:8px}
  .copy{float:right}
  @media (max-width:1100px){.layout{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="layout">
  <header>
    <h1>Manuale – JSON <span class="muted">SOLO Payload</span></h1>
    <p class="lead">Compila esclusivamente l'oggetto <strong>payload</strong> da incollare nel campo “Payload (JSON)”. I campi di testata si compilano nel form e NON vanno messi nel JSON.</p>
    <div class="toolbar">
      <button id="theme" class="ghost" aria-pressed="false" title="Tema chiaro/scuro">Tema</button>
      <span class="badge">Formati: <code>isoDateTime</code> <small>YYYY-MM-DDTHH:mm:ss</small> · <code>isoDate</code> <small>YYYY-MM-DD</small></span>
    </div>
  </header>

  <nav class="nav">
    <strong>Sezioni</strong>
    <a href="#note">Cosa NON mettere nel JSON</a>
    <a href="#defs">Definizioni comuni</a>
    <a href="#payloads">Campi payload per tipo</a>
    <a href="#examples">Esempi di payload</a>
    <a href="#generator">Generatore payload</a>
    <a href="#validator">Validatore payload</a>
  </nav>

  <main class="grid" style="gap:24px">

    <section id="note" class="section card">
      <h2>Cosa NON inserire nel JSON</h2>
      <div class="callout">
        Compila nel form e <u>non</u> nel payload: <code>type</code>, <code>title</code>, <code>summary</code>, <code>status</code>, <code>priority</code>, <code>published_at</code>, <code>partner_ids</code>. Il campo “Associa Partner” gestisce i partner. Il payload contiene SOLO i dettagli specifici.
      </div>
    </section>

    <section id="defs" class="section card">
      <h2>Definizioni comuni</h2>
      <details open><summary><strong>Formati</strong></summary>
        <table>
          <tr><td>isoDateTime</td><td>stringa <code>YYYY-MM-DDTHH:mm:ss</code></td></tr>
          <tr><td>isoDate</td><td>stringa <code>YYYY-MM-DD</code></td></tr>
          <tr><td>timezone</td><td>stringa IANA (es. <code>Europe/Rome</code>)</td></tr>
          <tr><td>url</td><td>URL valida (max 2048)</td></tr>
          <tr><td>email</td><td>pattern e-mail</td></tr>
          <tr><td>tag</td><td>1–24 caratteri; <em>tags</em> è un array di tag unici</td></tr>
        </table>
      </details>

      <details><summary><strong>Oggetti riutilizzabili</strong></summary>
        <table>
          <tr><th>Oggetto</th><th>Campi</th></tr>
          <tr><td>seo</td><td>slug (3–80), keywords[], image(url)</td></tr>
          <tr><td>attachment</td><td>label(1–60), url, type(pdf|image|doc|sheet|other)</td></tr>
          <tr><td>mediaImage</td><td>type:"image", url, caption(≤160), alt(≥1)</td></tr>
          <tr><td>mediaVideo</td><td>type:"video", url, caption(≤160), provider(youtube|vimeo|file)</td></tr>
          <tr><td>mediaGallery</td><td>type:"gallery", items[ mediaImage|mediaVideo ] (≥1)</td></tr>
          <tr><td>link</td><td>label(1–60), url, rel, external(bool)</td></tr>
          <tr><td>contact</td><td>name(obbl.), role, email, url, avatar_url</td></tr>
          <tr><td>venue</td><td>name(obbl.), address, lat(-90..90), lon(-180..180), room, map_url</td></tr>
          <tr><td>registration</td><td>required(bool, obbl.), url, deadline(isoDateTime)</td></tr>
          <tr><td>livestream</td><td>enabled(bool, obbl.), platform, url</td></tr>
          <tr><td>agendaItem</td><td>time(HH:mm), title, speakers[]</td></tr>
          <tr><td>speaker</td><td>name(obbl.), affiliation, bio, avatar_url</td></tr>
          <tr><td>tickets</td><td>free(bool, obbl.), capacity≥0, sold≥0, price_eur≥0</td></tr>
          <tr><td>milestone</td><td>date(isoDate), title, desc</td></tr>
          <tr><td>timeline</td><td>start(isoDate), end(isoDate), milestones[]</td></tr>
        </table>
      </details>
    </section>

    <section id="payloads" class="section card">
      <h2>Campi del payload</h2>
      <div class="tabbar" role="tablist">
        <button class="active" role="tab" data-tab="event">event</button>
        <button role="tab" data-tab="collaboration">collaboration</button>
        <button role="tab" data-tab="announcement">announcement</button>
        <button role="tab" data-tab="news">news</button>
      </div>
      <div id="tab-event">
        <table>
          <tr><th>Campo</th><th>Tipo</th><th>Regole</th><th>Descrizione</th></tr>
          <tr><td>schema_version</td><td>integer</td><td>≥1 (default 1)</td><td>Versione</td></tr>
          <tr><td>tags</td><td>array&lt;tag&gt;</td><td>unici</td><td>Etichette</td></tr>
          <tr><td>seo</td><td>seo</td><td>—</td><td>Metadati</td></tr>
          <tr><td>attachments</td><td>array&lt;attachment&gt;</td><td>—</td><td>Allegati</td></tr>
          <tr><td>media</td><td>media</td><td>—</td><td>Immagini/Video</td></tr>
          <tr><td>links</td><td>array&lt;link&gt;</td><td>—</td><td>Link</td></tr>
          <tr><td>contacts</td><td>array&lt;contact&gt;</td><td>—</td><td>Contatti</td></tr>
          <tr><td>notes_md</td><td>string</td><td>markdown</td><td>Note</td></tr>
          <tr><td>start_at</td><td>isoDateTime</td><td>—</td><td>Inizio</td></tr>
          <tr><td>end_at</td><td>isoDateTime</td><td>—</td><td>Fine</td></tr>
          <tr><td>timezone</td><td>timezone</td><td>IANA</td><td>Fuso</td></tr>
          <tr><td>venue</td><td>venue</td><td>—</td><td>Luogo</td></tr>
          <tr><td>online</td><td>boolean</td><td>—</td><td>Evento online</td></tr>
          <tr><td>livestream</td><td>livestream</td><td>—</td><td>Streaming</td></tr>
          <tr><td>registration</td><td>registration</td><td>—</td><td>Registrazione</td></tr>
          <tr><td>agenda</td><td>array&lt;agendaItem&gt;</td><td>—</td><td>Programma</td></tr>
          <tr><td>speakers</td><td>array&lt;speaker&gt;</td><td>—</td><td>Relatori</td></tr>
          <tr><td>tickets</td><td>tickets</td><td>—</td><td>Biglietti</td></tr>
        </table>
        <p class="muted">Se uno tra <code>start_at</code> e <code>end_at</code> è presente, deve esserlo anche l’altro.</p>
      </div>
      <div id="tab-collaboration" hidden>
        <table>
          <tr><th>Campo</th><th>Tipo</th><th>Regole</th><th>Descrizione</th></tr>
          <tr><td>schema_version</td><td>integer</td><td>≥1</td><td>Versione</td></tr>
          <tr><td>tags, seo, attachments, media, links, contacts, notes_md</td><td>vari</td><td>—</td><td>Campi comuni</td></tr>
          <tr><td>goal</td><td>string</td><td>—</td><td>Obiettivo</td></tr>
          <tr><td>work_packages</td><td>array&lt;string&gt;</td><td>—</td><td>Pacchetti</td></tr>
          <tr><td>timeline</td><td>timeline</td><td>—</td><td>Pianificazione</td></tr>
          <tr><td>requirements.tech</td><td>array&lt;string&gt;</td><td>—</td><td>Requisiti tecnici</td></tr>
          <tr><td>requirements.non_tech</td><td>array&lt;string&gt;</td><td>—</td><td>Requisiti non tecnici</td></tr>
          <tr><td>funding.status</td><td>string</td><td>secured|in_progress|needed</td><td>Stato</td></tr>
          <tr><td>funding.sources</td><td>array&lt;string&gt;</td><td>—</td><td>Fonti</td></tr>
        </table>
      </div>
      <div id="tab-announcement" hidden>
        <table>
          <tr><th>Campo</th><th>Tipo</th><th>Regole</th><th>Descrizione</th></tr>
          <tr><td>schema_version</td><td>integer</td><td>≥1</td><td>Versione</td></tr>
          <tr><td>tags, seo, attachments, media, links, contacts, notes_md</td><td>vari</td><td>—</td><td>Campi comuni</td></tr>
          <tr><td>changelog</td><td>array&lt;string&gt;</td><td>—</td><td>Novità</td></tr>
          <tr><td>breaking_changes</td><td>array&lt;string&gt;</td><td>—</td><td>Modifiche critiche</td></tr>
          <tr><td>docs_url</td><td>url</td><td>—</td><td>Documentazione</td></tr>
          <tr><td>rollout.type</td><td>string</td><td>global|gradual|canary</td><td>Tipo</td></tr>
          <tr><td>rollout.percent</td><td>integer</td><td>0–100</td><td>Percentuale</td></tr>
        </table>
      </div>
      <div id="tab-news" hidden>
        <table>
          <tr><th>Campo</th><th>Tipo</th><th>Regole</th><th>Descrizione</th></tr>
          <tr><td>schema_version</td><td>integer</td><td>≥1</td><td>Versione</td></tr>
          <tr><td>tags, seo, attachments, media, links, contacts, notes_md</td><td>vari</td><td>—</td><td>Campi comuni</td></tr>
          <tr><td>body_md</td><td>string</td><td>markdown</td><td>Corpo</td></tr>
          <tr><td>quotes[].author</td><td>string</td><td>—</td><td>Autore</td></tr>
          <tr><td>quotes[].text</td><td>string</td><td>—</td><td>Citazione</td></tr>
          <tr><td>media</td><td>media</td><td>—</td><td>Media</td></tr>
          <tr><td>seo</td><td>seo</td><td>—</td><td>SEO</td></tr>
        </table>
      </div>
    </section>

    <section id="examples" class="section card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 style="margin:0">Esempi di <u>payload</u> pronti</h2>
        <div>
          <button class="ghost" id="copyAllExamples">Copia tutti</button>
        </div>
      </div>

      <details open>
        <summary><strong>event</strong> – completo</summary>
        <button class="copy" data-copy="#ex-event">Copia</button>
<pre id="ex-event">{
  "schema_version": 1,
  "tags": ["workshop", "marine"],
  "seo": {"slug": "workshop-biologia-marina", "keywords": ["biologia", "monitoraggio"], "image": "https://example.org/img/cover.jpg"},
  "attachments": [{"label": "Programma PDF", "url": "https://example.org/program.pdf", "type": "pdf"}],
  "media": [
    {"type": "image", "url": "https://example.org/img/locandina.jpg", "caption": "Locandina", "alt": "Locandina workshop"},
    {"type": "video", "url": "https://video.example.org/stream.mp4", "provider": "file", "caption": "Promo"}
  ],
  "links": [{"label": "Sito evento", "url": "https://example.org/evento", "external": true}],
  "contacts": [{"name": "Segreteria", "email": "info@example.org"}],
  "notes_md": "Note interne…",

  "start_at": "2025-09-12T10:00:00",
  "end_at": "2025-09-12T16:00:00",
  "timezone": "Europe/Rome",
  "venue": {"name": "Università di Napoli", "address": "Via Partenope 36, Napoli", "lat": 40.83, "lon": 14.25, "room": "Aula Magna", "map_url": "https://maps.example.org/venue"},
  "online": false,
  "livestream": {"enabled": true, "platform": "YouTube", "url": "https://youtube.com/live/abc"},
  "registration": {"required": true, "url": "https://tickets.example.org/reg", "deadline": "2025-09-10T18:00:00"},
  "agenda": [
    {"time": "10:00", "title": "Apertura", "speakers": ["Comitato"]},
    {"time": "10:30", "title": "Tecniche di eDNA", "speakers": ["Dott.ssa Rossi", "Dott. Bianchi"]}
  ],
  "speakers": [
    {"name": "Dott.ssa Maria Rossi", "affiliation": "UniNapoli", "bio": "Ricercatrice in ecologia marina"},
    {"name": "Dott. Luca Bianchi", "affiliation": "CNR", "bio": "Modelli di habitat"}
  ],
  "tickets": {"free": false, "capacity": 200, "sold": 57, "price_eur": 25}
}
</pre>
      </details>

      <details>
        <summary><strong>collaboration</strong> – proposta</summary>
        <button class="copy" data-copy="#ex-collab">Copia</button>
<pre id="ex-collab">{
  "schema_version": 1,
  "tags": ["collab", "hardware"],
  "seo": {"slug": "rete-sensori-costieri"},
  "links": [{"label": "Repository", "url": "https://example.org/repo", "external": true}],
  "goal": "Sviluppo di una rete di sensori meteo-marine open-source",
  "work_packages": ["Progettazione HW", "Firmware", "Integrazione API", "Deployment"],
  "timeline": {
    "start": "2025-10-01",
    "end": "2026-03-31",
    "milestones": [
      {"date": "2025-11-15", "title": "Prototipo v1"},
      {"date": "2026-01-15", "title": "Test costieri"}
    ]
  },
  "requirements": {
    "tech": ["ESP32", "LoRaWAN", "Flask API"],
    "non_tech": ["Permessi locali", "Contratti hosting"]
  },
  "funding": {"status": "in_progress", "sources": ["EIC", "Fondazioni"]}
}
</pre>
      </details>

      <details>
        <summary><strong>announcement</strong> – rilascio</summary>
        <button class="copy" data-copy="#ex-ann">Copia</button>
<pre id="ex-ann">{
  "schema_version": 1,
  "tags": ["release", "admin"],
  "changelog": [
    "Creazione eventi semplificata",
    "Editor markdown migliorato"
  ],
  "breaking_changes": ["Aggiornare le chiavi API per l'upload"],
  "docs_url": "https://docs.example.org/console",
  "rollout": {"type": "gradual", "percent": 25}
}
</pre>
      </details>

      <details>
        <summary><strong>news</strong> – comunicato</summary>
        <button class="copy" data-copy="#ex-news">Copia</button>
<pre id="ex-news">{
  "schema_version": 1,
  "tags": ["edna", "dataset"],
  "seo": {"slug": "edna-primi-risultati", "keywords": ["edna", "monitoraggio"]},
  "body_md": "Abbiamo rilasciato i primi risultati del progetto **eDNA**…",
  "quotes": [
    {"author": "Coordinatore Progetto", "text": "Risultati incoraggianti"}
  ],
  "media": [{"type": "image", "url": "https://example.org/edna.jpg", "alt": "Campionamento"}]
}
</pre>
      </details>
    </section>

    <section id="generator" class="section card">
      <h2>Generatore di payload</h2>
      <div class="grid two">
        <div>
          <label>Tipo</label>
          <select id="gen-type">
            <option value="event">event</option>
            <option value="collaboration">collaboration</option>
            <option value="announcement">announcement</option>
            <option value="news">news</option>
          </select>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="primary" id="gen-build">Crea scheletro</button>
            <button id="gen-pretty">Formatta</button>
            <button id="gen-minify">Minifica</button>
            <button class="ghost" id="gen-copy">Copia</button>
          </div>
        </div>
        <div>
          <textarea id="gen-output" class="input" style="width:100%;min-height:220px" spellcheck="false" placeholder="Qui apparirà il payload…"></textarea>
        </div>
      </div>
    </section>

    <section id="validator" class="section card">
      <h2>Validatore di payload (controlli base)</h2>
      <p class="muted">Seleziona il tipo per applicare le regole corrette. Non sostituisce un validatore JSON Schema completo.</p>
      <div class="grid two">
        <div>
          <label>Tipo</label>
          <select id="val-type">
            <option value="event">event</option>
            <option value="collaboration">collaboration</option>
            <option value="announcement">announcement</option>
            <option value="news">news</option>
          </select>
          <textarea id="val-input" class="input" style="width:100%;min-height:240px;margin-top:8px" spellcheck="false" placeholder="Incolla qui il payload da verificare…"></textarea>
        </div>
        <div>
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button class="primary" id="val-run">Valida</button>
            <button class="ghost" id="val-pretty">Formatta</button>
            <button class="ghost" id="val-minify">Minifica</button>
          </div>
          <div id="val-result" class="card" style="min-height:120px"></div>
        </div>
      </div>
    </section>

  </main>
</div>

<script>
(function(){
  const $ = s=>document.querySelector(s); const $$ = s=>Array.from(document.querySelectorAll(s));
  // Theme
  $('#theme').addEventListener('click', e=>{ const on=document.documentElement.classList.toggle('light'); e.currentTarget.setAttribute('aria-pressed', String(on)); });

  // Tabs
  $$('.tabbar button').forEach(b=>b.addEventListener('click',()=>{ $$('.tabbar button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); ['event','collaboration','announcement','news'].forEach(k=>{ const el=$('#tab-'+k); el.hidden = (k!==b.dataset.tab); }); }));

  // Copy helpers
  function getText(sel){ const el=document.querySelector(sel); return el?el.textContent:''; }
  $$('.copy').forEach(btn=>btn.addEventListener('click',()=>navigator.clipboard.writeText(getText(btn.dataset.copy))));
  const all = ['#ex-event','#ex-collab','#ex-ann','#ex-news'];
  document.getElementById('copyAllExamples')?.addEventListener('click',()=>{ const blocks=all.map(getText); navigator.clipboard.writeText(blocks.join('\n\n')); });

  // Generator (payload only)
  const genOut=document.getElementById('gen-output'); const genType=document.getElementById('gen-type');
  const baseCommon = { schema_version:1 };
  const skel = {
    event: ()=>({ ...baseCommon, start_at:"2025-01-01T10:00:00", end_at:"2025-01-01T12:00:00", timezone:"Europe/Rome", venue:{ name:"Sede" }, online:false }),
    collaboration: ()=>({ ...baseCommon, goal:"Obiettivo", work_packages:["WP1"], requirements:{ tech:[], non_tech:[] } }),
    announcement: ()=>({ ...baseCommon, changelog:["Novità"], rollout:{ type:"global", percent:100 } }),
    news: ()=>({ ...baseCommon, body_md:"Testo" })
  };
  document.getElementById('gen-build').addEventListener('click',()=>{ const t=genType.value; genOut.value = JSON.stringify(skel[t](), null, 2); });
  document.getElementById('gen-pretty').addEventListener('click',()=>{ try{ genOut.value = JSON.stringify(JSON.parse(genOut.value), null, 2);}catch{} });
  document.getElementById('gen-minify').addEventListener('click',()=>{ try{ genOut.value = JSON.stringify(JSON.parse(genOut.value)); }catch{} });
  document.getElementById('gen-copy').addEventListener('click',()=>navigator.clipboard.writeText(genOut.value));

  // Validator (payload-only)
  const patt = { isoDateTime:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/, isoDate:/^\d{4}-\d{2}-\d{2}$/, time:/^[0-2]\d:[0-5]\d$/, email:/.+@.+\..+/ };
  function vPayload(obj,type){ const e=[]; const add=(p,m)=>e.push({path:p,msg:m});
    if(typeof obj!== 'object' || Array.isArray(obj) || obj===null){ add('$','Deve essere un oggetto'); return e; }
    if('schema_version' in obj && (!Number.isInteger(obj.schema_version) || obj.schema_version<1)) add('schema_version','Intero ≥1');
    if('tags' in obj){ if(!Array.isArray(obj.tags)) add('tags','Array'); else { const set=new Set(); obj.tags.forEach((t,i)=>{ if(typeof t!=='string'||t.length<1||t.length>24) add(`tags[${i}]`,'Stringa 1–24'); if(set.has(t)) add(`tags[${i}]`,'Duplicato'); set.add(t); }); }}
    if('contacts' in obj){ if(!Array.isArray(obj.contacts)) add('contacts','Array'); else obj.contacts.forEach((c,i)=>{ if(typeof c.name!=='string'||!c.name) add(`contacts[${i}].name`,'Obbligatorio'); if('email' in c && !patt.email.test(c.email)) add(`contacts[${i}].email`,'Email non valida'); }); }
    if(type==='event'){
      const hasStart='start_at' in obj, hasEnd='end_at' in obj; if(hasStart^hasEnd) add('start_at|end_at','Entrambi obbligatori se uno è presente');
      if(hasStart && !patt.isoDateTime.test(obj.start_at)) add('start_at','YYYY-MM-DDTHH:mm:ss');
      if(hasEnd && !patt.isoDateTime.test(obj.end_at)) add('end_at','YYYY-MM-DDTHH:mm:ss');
      if('agenda' in obj){ if(!Array.isArray(obj.agenda)) add('agenda','Array'); else obj.agenda.forEach((a,i)=>{ if(!patt.time.test(a.time||'')) add(`agenda[${i}].time`,'HH:mm'); if(typeof a.title!=='string'||!a.title) add(`agenda[${i}].title`,'Obbligatorio'); }); }
      if('speakers' in obj){ if(!Array.isArray(obj.speakers)) add('speakers','Array'); else obj.speakers.forEach((s,i)=>{ if(typeof s.name!=='string'||!s.name) add(`speakers[${i}].name`,'Obbligatorio'); }); }
      if('tickets' in obj){ const t=obj.tickets; if(typeof t!=='object'||t===null) add('tickets','Oggetto'); else if('free' in t && typeof t.free!=='boolean') add('tickets.free','Booleano'); }
    }
    if(type==='announcement'){
      if('rollout' in obj){ const r=obj.rollout||{}; if('type' in r && !['global','gradual','canary'].includes(r.type)) add('rollout.type','Valore non valido'); if('percent' in r && (!Number.isInteger(r.percent)||r.percent<0||r.percent>100)) add('rollout.percent','0..100'); }
    }
    if(type==='collaboration'){
      if('funding' in obj){ const f=obj.funding||{}; if('status' in f && !['secured','in_progress','needed'].includes(f.status)) add('funding.status','Valore non valido'); }
    }
    return e;
  }
  function render(list){ const box=document.getElementById('val-result'); if(!list.length){ box.innerHTML='<div class="badge ok">OK</div> Nessun errore (controlli base).'; box.style.borderLeft='4px solid var(--good)'; return;} const items=list.map(x=>`<li><code>${x.path}</code> — ${x.msg}</li>`).join(''); box.innerHTML=`<div class="badge bad">ERRORI</div><ul>${items}</ul>`; box.style.borderLeft='4px solid var(--bad)'; }
  document.getElementById('val-run').addEventListener('click',()=>{ try{ const o=JSON.parse(document.getElementById('val-input').value); render(vPayload(o,document.getElementById('val-type').value)); }catch(err){ render([{path:'$',msg:'JSON non valido: '+err.message}]); }});
  document.getElementById('val-pretty').addEventListener('click',()=>{ try{ const o=JSON.parse(document.getElementById('val-input').value); document.getElementById('val-input').value=JSON.stringify(o,null,2);}catch{} });
  document.getElementById('val-minify').addEventListener('click',()=>{ try{ const o=JSON.parse(document.getElementById('val-input').value); document.getElementById('val-input').value=JSON.stringify(o);}catch{} });
})();
</script>
</body>
</html>
